# TCP协议

报文格式：

1. 源端口(16)：发送端端口

2. 目的端口(16)：目的端口

   > TCP的源端口、目的端口和IP的源IP、目的IP四元组标识了一个TCP连接
   >
   > IP+端口号的组合叫做socket。

3. 序列号(SN, Sequence Number, 32)：当SYN标志位设置时，该字段也称为ISN(initial sequence number)，ISN是由发送端随机产生的。表示了TCP报文中第一个byte在对应方向传输中对应的字节序号。

4. 确认号/应答号(Acknowledgment Number, ACK, 32)：在抓包软件中一般显示相对的Number

   > ### 建立连接
   >
   > | 客户端                            | 服务端                       |
   > | --------------------------------- | ---------------------------- |
   > | 随机生成ISN，ACK=0                |                              |
   > |                                   | 随机生成SN，ACK为客户端ISN+1 |
   > | 客户端SN为ISN+1，ACK为 服务端SN+1 |                              |
   >
   > ### HTTP数据传输中的TCP
   >
   > | 客户端      | 服务端                                                       |
   > | ----------- | ------------------------------------------------------------ |
   > | SN，ACK同上 |                                                              |
   > |             | SN=客户端SN，ACK=SN+TCP(?)数据长度（该条是**响应包**）       |
   > |             | 服务器处理请求http后返回响应；SN，ACK同上 [携带数据于上不同] |
   >
   > ![](http://doze9097.top//1573807498451.png)

![img](http://images2017.cnblogs.com/blog/1232796/201710/1232796-20171016101818052-288210898.gif)

